# 📊 Data Flow Overview v1.2 — 서비스 데이터 구조 개요 (MVP 완성판)

> **Version**: 1.2  
> **Last Updated**: 2025-12-19  
> **변경사항**: M11~M20 신규 데이터 도메인 반영

---

## 🔄 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| v1.0 | 2025-11 | 초기 데이터 구조 정의 (6개 도메인) |
| v1.2 | 2025-12-19 | **10개 도메인**으로 확장, 신규 기능 반영 |

---

## 1. 서비스 전체 데이터 구조 개요

이 서비스에서 다루는 모든 데이터는 다음 **10개 도메인**으로 구성된다:

### 기존 도메인 (v1.0)
1. User & Family Data
2. Student Academic & Activity Data
3. School / Admissions / Schedule Data
4. Diagnosis & Recommendation Data
5. AI Analysis Data
6. Subscription / Payment / Consultation Data

### 신규 도메인 (v1.2) ⭐
7. **News & Content Data** - 뉴스 및 콘텐츠
8. **Community Data** - 커뮤니티 Q&A, 합격생 후기
9. **Gamification Data** - 뱃지, 목표 추적
10. **Analytics & Reporting Data** - 분석, 리포트

---

## 2. 도메인별 데이터 상세

### 2.1 User & Family Data

| 항목 | 내용 |
|------|------|
| **데이터 종류** | 학생 프로필, 학부모 정보, 컨설턴트 정보, 가족 구성 관계 |
| **생성** | 회원가입, 초대 코드 연결, 컨설턴트 승인 |
| **저장** | `users`, `families`, `consultants` |
| **활용** | 권한(Role) 결정, 데이터 공유, 가족 할인, 상담 연결 |
| **노출 대상** | 학생(자기 정보), 학부모(자녀), 컨설턴트(담당 학생), 관리자(운영) |

#### v1.2 추가 사항 ⭐
- **온보딩 완료 상태** (`onboardingCompleted`)
- **이메일 알림 설정** (`emailNotifications`)
- **마지막 로그인 시간** (`lastLoginAt`)

---

### 2.2 Student Academic & Activity Data

| 항목 | 내용 |
|------|------|
| **데이터 종류** | 성적(지필/수행), 학생부 활동, 동아리/창체, 독서 기록 |
| **생성** | 학생 직접 입력, 학부모 검토 & 승인 |
| **저장** | `grades`, `activities`, `reading_logs` |
| **활용** | 진단 엔진, AI 에이전트, 대시보드, 상담 준비 |
| **노출 대상** | 학생, 학부모, 컨설턴트(승인 시) |

#### v1.2 추가 사항 ⭐
- **성적 목표 설정** (`grade_goals`)
- **성적 트렌드 분석** (계산 데이터)
- **활동 이력 타임라인** (`activity_logs`)

---

### 2.3 School / Admissions / Schedule Data

| 항목 | 내용 |
|------|------|
| **데이터 종류** | 고등학교 정보, 전형 요소, 입시 일정, **경쟁률 데이터** |
| **생성** | Puppeteer 크롤러 수집, 관리자 검토 후 공개 |
| **저장** | `schools`, `admissions`, `admission_schedules`, `competition_rates` |
| **활용** | 진단 엔진, 목표 학교 가이드, 일정 캘린더, **학교 비교** |
| **노출 대상** | 전체 사용자, 관리자(검토/승인) |

#### v1.2 추가 사항 ⭐
- **학교 홈페이지 URL** (`websiteUrl`)
- **역대 경쟁률** (2019~2025년)
- **학교 비교 분석** 데이터
- **D-Day 이벤트** (`d_day_events`)

---

### 2.4 Diagnosis & Recommendation Data

| 항목 | 내용 |
|------|------|
| **데이터 종류** | FIT/CHALLENGE/UNLIKELY, 추천 목록, 강점/약점, 액션 플랜 |
| **생성** | 진단 엔진 (룰 기반 + AI 기반), AI 액션 플랜 에이전트 |
| **저장** | `diagnosis_results`, `action_plans`, `plan_tasks` |
| **활용** | 학생 홈, 학부모 대시보드, 목표 학교 가이드, 상담 리포트 |
| **노출 대상** | 학생, 학부모, 컨설턴트(승인 시) |

#### v1.2 추가 사항 ⭐
- **합격 확률 예측** (`admission_predictions`)
- **합격 시뮬레이션 결과** (`simulation_results`)
- **성적 트렌드 분석 결과** (`grade_trends`)
- **AI 플랜 → 태스크 자동 변환**

---

### 2.5 AI Analysis Data

| 항목 | 내용 |
|------|------|
| **데이터 종류** | 생기부 문장, 동아리/교과/독서 조언, 액션 플랜, AI 로그 |
| **생성** | NestJS AI Module → **Google Gemini API** 호출 |
| **저장** | `ai_outputs`, `ai_prompt_versions`, `ai_logs` |
| **활용** | 학생부 자동화, 활동 계획, 전략, 상담 보조, PDF 보고서 |
| **노출 대상** | 학생, 학부모, 컨설턴트(해당 학생만) |

#### v1.2 추가 사항 ⭐

| 새로운 AI 기능 | 저장 테이블 |
|---------------|------------|
| **AI 자기소개서 생성** | `personal_statements` |
| **AI 자기소개서 첨삭** | `statement_reviews` |
| **면접 예상 질문** | `interview_questions` |
| **모의 면접 결과** | `mock_interviews` |
| **학교별 합격 예측** | `admission_predictions` |

---

### 2.6 Subscription / Payment / Consultation Data

| 항목 | 내용 |
|------|------|
| **데이터 종류** | 결제 이력, 구독 상태, 할인, 상담 예약/내용/리포트 |
| **생성** | 부모 결제 신청, PG Webhook, 상담 예약 |
| **저장** | `subscriptions`, `payments`, `consultations`, `consultation_reports` |
| **활용** | 기능 접근 제어, 프리미엄 기능, 상담 관리, 수익 분석 |
| **노출 대상** | 학부모, 학생(상담 결과), 컨설턴트, 관리자 |

#### v1.2 추가 사항 ⭐
- **상담 예약 캘린더 연동**
- **PDF 리포트 생성/다운로드**
- **상담 시간 슬롯 관리** (`consultation_slots`)

---

### 2.7 News & Content Data (신규) ⭐

| 항목 | 내용 |
|------|------|
| **데이터 종류** | 뉴스 기사, 뉴스 북마크, 콘텐츠 메타데이터 |
| **생성** | Google News RSS 크롤링, 사용자 북마크 |
| **저장** | `news_articles` (캐시), `news_bookmarks` |
| **활용** | 최신 뉴스 피드, 키워드 필터링, 북마크 관리 |
| **노출 대상** | 학생, 학부모 |

```
데이터 구조:
┌─────────────────────────────────────────┐
│ News Article                            │
├─────────────────────────────────────────┤
│ - title: 기사 제목                       │
│ - source: 출처 (Google News)            │
│ - url: 원문 링크                         │
│ - publishedAt: 발행일                    │
│ - keywords: [외고, 자사고, 과학고, ...]   │
│ - thumbnail: 썸네일 이미지               │
└─────────────────────────────────────────┘
```

---

### 2.8 Community Data (신규) ⭐

| 항목 | 내용 |
|------|------|
| **데이터 종류** | Q&A 질문/답변, 합격 후기, 댓글, 좋아요 |
| **생성** | 사용자 작성, 좋아요/채택 액션 |
| **저장** | `questions`, `answers`, `success_stories`, `comments`, `likes` |
| **활용** | 커뮤니티 운영, 정보 공유, 검증된 후기 |
| **노출 대상** | 전체 사용자, 관리자(검증/관리) |

```
데이터 구조:
┌─────────────────────────────────────────┐
│ Question (Q&A)                          │
├─────────────────────────────────────────┤
│ - title: 질문 제목                       │
│ - content: 질문 내용                     │
│ - category: [진로, 학습, 입시, ...]      │
│ - authorId: 작성자                       │
│ - answers: [Answer]                     │
│ - acceptedAnswerId: 채택된 답변          │
│ - likeCount: 좋아요 수                   │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│ Success Story (합격 후기)                │
├─────────────────────────────────────────┤
│ - title: 후기 제목                       │
│ - content: 후기 내용                     │
│ - schoolId: 합격 학교                    │
│ - admissionYear: 합격 연도               │
│ - isVerified: 검증 여부                  │
│ - comments: [Comment]                   │
│ - likeCount: 좋아요 수                   │
└─────────────────────────────────────────┘
```

---

### 2.9 Gamification Data (신규) ⭐

| 항목 | 내용 |
|------|------|
| **데이터 종류** | 뱃지, 뱃지 획득 이력, 목표 설정, 목표 달성 |
| **생성** | 시스템 자동 부여 (액션 기반), 사용자 목표 설정 |
| **저장** | `badges`, `user_badges`, `grade_goals`, `goal_achievements` |
| **활용** | 학습 동기 부여, 목표 추적, 성취 표시 |
| **노출 대상** | 학생, 학부모(자녀) |

```
뱃지 시스템:
┌─────────────────────────────────────────┐
│ Badge                                   │
├─────────────────────────────────────────┤
│ 🎯 첫 진단: FIRST_DIAGNOSIS             │
│ 📝 기록왕: RECORD_MASTER (성적 10회)     │
│ 🤖 AI 마스터: AI_MASTER (AI 20회)       │
│ ✅ 실천왕: TASK_MASTER (태스크 50개)     │
│ 📚 독서왕: READING_MASTER (10권)        │
│ 🏆 목표 달성: GOAL_ACHIEVER             │
│ 💬 질문왕: QUESTION_MASTER              │
│ 🌟 도움왕: HELPER_MASTER                │
│ 🔥 연속 출석: STREAK_MASTER             │
│ 🎓 합격생: ADMITTED_STUDENT             │
└─────────────────────────────────────────┘

목표 추적:
┌─────────────────────────────────────────┐
│ Grade Goal                              │
├─────────────────────────────────────────┤
│ - subject: 과목                         │
│ - targetScore: 목표 점수                 │
│ - currentScore: 현재 점수                │
│ - progress: 진행률 (%)                   │
│ - achievedAt: 달성 일시                  │
└─────────────────────────────────────────┘
```

---

### 2.10 Analytics & Reporting Data (신규) ⭐

| 항목 | 내용 |
|------|------|
| **데이터 종류** | 성적 트렌드, 활동 분석, KPI, 사용 통계 |
| **생성** | 배치 처리, 실시간 계산 |
| **저장** | `grade_trends`, `activity_analytics`, `kpi_snapshots` |
| **활용** | 대시보드, 리포트, 관리자 모니터링 |
| **노출 대상** | 학생(자기), 학부모(자녀), 관리자(전체) |

```
성적 트렌드:
┌─────────────────────────────────────────┐
│ Grade Trend                             │
├─────────────────────────────────────────┤
│ - subject: 과목                         │
│ - scores: [92, 88, 95, 91]              │
│ - dates: [2024-03, 2024-06, ...]        │
│ - trend: IMPROVING | DECLINING | STABLE │
│ - improvement: +3.5%                    │
│ - advice: "수학 성적이 향상 중입니다..."  │
└─────────────────────────────────────────┘
```

---

## 3. 전체 데이터 파이프라인 (v1.2 업데이트)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              DATA PIPELINE v1.2                              │
└─────────────────────────────────────────────────────────────────────────────┘

[학생 입력]
    │
    ├──→ 성적/활동/독서 데이터
    │         │
    │         ▼
    │    [구조화 저장 - PostgreSQL]
    │         │
    │         ├──→ 진단 엔진 ──→ FIT/CHALLENGE/UNLIKELY
    │         │         │
    │         │         ├──→ 합격 확률 예측 (신규)
    │         │         └──→ 성적 트렌드 분석 (신규)
    │         │
    │         ├──→ AI 에이전트 분석
    │         │         │
    │         │         ├──→ 액션 플랜 생성
    │         │         ├──→ AI 자기소개서 (신규)
    │         │         ├──→ 면접 준비 (신규)
    │         │         └──→ 학교 합격 예측 (신규)
    │         │
    │         └──→ 추천/액션 플랜 생성
    │                   │
    │                   ▼
    │              [학생/학부모/컨설턴트 대시보드]
    │                   │
    │                   ├──→ D-Day 대시보드 (신규)
    │                   ├──→ 성적 차트 (신규)
    │                   └──→ 뱃지 표시 (신규)
    │
    ├──→ 목표 설정 ──→ 진행률 추적 ──→ 뱃지 획득 (신규)
    │
    └──→ 커뮤니티 참여 ──→ Q&A / 후기 ──→ 좋아요/채택 (신규)

[외부 데이터]
    │
    ├──→ Google News RSS ──→ 뉴스 크롤링 ──→ 뉴스 피드 (신규)
    │
    └──→ 학교 홈페이지 ──→ Puppeteer 크롤링 ──→ 학교/전형/일정 DB

[학부모 검토]
    │
    └──→ 부모 승인/피드백 ──→ 리포트/PDF/상담으로 연결

[컨설턴트 상담]
    │
    └──→ 상담 예약 ──→ 상담 진행 ──→ 리포트 작성 ──→ PDF 생성
```

---

## 4. 핵심 요약 (v1.2 업데이트)

| 역할 | 핵심 액션 |
|------|----------|
| **입력** | 학생 |
| **검토** | 학부모 |
| **분석** | 진단 엔진 + AI (Gemini) |
| **전략** | AI (자세 설명, 자소서, 면접) |
| **동기부여** | 게이미피케이션 (뱃지, 목표) |
| **정보 공유** | 커뮤니티 (Q&A, 합격 후기) |
| **의사결정** | 학부모 |
| **고도화** | 컨설턴트 |

---

## 5. 권한 & 가시성 요약 (v1.2 업데이트)

| 데이터 | 학생 | 학부모 | 컨설턴트 | 관리자 |
|--------|------|--------|---------|--------|
| 자신의 성적/활동 | ✅ | ✅(자녀) | ✅(담당) | ❌ |
| AI 분석 결과 | ✅ | ✅ | ✅ | 제한적 |
| 진단/추천 | ✅ | ✅ | ✅ | 통계만 |
| 학교/전형/일정 | ✅ | ✅ | ✅ | ✅ |
| 결제/구독 | ❌ | ✅ | ❌ | ✅ |
| 상담 리포트 | ✅ | ✅ | ✅ | ❌ |
| **뉴스** (신규) | ✅ | ✅ | ❌ | ❌ |
| **커뮤니티** (신규) | ✅ | ✅ | ❌ | ✅(관리) |
| **뱃지** (신규) | ✅ | ✅(자녀) | ❌ | ✅(설정) |
| **합격 예측** (신규) | ✅ | ✅(자녀) | ✅(담당) | 통계만 |

---

## 6. 데이터 규모 (v1.2)

| 카테고리 | 테이블 | 예상 레코드 |
|----------|--------|------------|
| 사용자 | users, families | ~10,000 |
| 학교 | schools | 433개 (341 중학교 + 92 고등학교) |
| 입시 일정 | admission_schedules | 109개 (2025) |
| 동아리 | clubs | 140개 |
| 성적 | grades | ~100,000 |
| AI 출력 | ai_outputs | ~50,000 |
| 뉴스 | news_articles (캐시) | ~1,000 |
| 커뮤니티 | questions, stories | ~5,000 |
| 뱃지 | user_badges | ~20,000 |

---

## 7. 데이터베이스 스키마 개요 (v1.2)

```
┌──────────────────────────────────────────────────────────────────────────┐
│                          DATABASE SCHEMA v1.2                            │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐                │
│  │    User     │────▶│   Family    │◀────│   Student   │                │
│  └─────────────┘     └─────────────┘     └──────┬──────┘                │
│         │                                       │                        │
│         │                    ┌──────────────────┼──────────────────┐     │
│         │                    │                  │                  │     │
│         ▼                    ▼                  ▼                  ▼     │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐    ┌──────────┐│
│  │ UserBadge   │     │   Grade     │     │  Activity   │    │ AIOutput ││
│  └─────────────┘     └─────────────┘     └─────────────┘    └──────────┘│
│         │                   │                   │                  │     │
│         ▼                   ▼                   ▼                  ▼     │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐    ┌──────────┐│
│  │   Badge     │     │ GradeGoal   │     │ Diagnosis   │    │ Personal ││
│  └─────────────┘     └─────────────┘     └─────────────┘    │ Statement││
│                             │                   │            └──────────┘│
│                             ▼                   ▼                        │
│                      ┌─────────────┐     ┌─────────────┐                │
│                      │ GradeTrend  │     │ Prediction  │                │
│                      └─────────────┘     └─────────────┘                │
│                                                                          │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐                │
│  │   School    │────▶│ Admission   │────▶│  Schedule   │                │
│  └─────────────┘     └─────────────┘     └─────────────┘                │
│         │                                       │                        │
│         ▼                                       ▼                        │
│  ┌─────────────┐                         ┌─────────────┐                │
│  │ Competition │                         │  DDayEvent  │                │
│  │    Rate     │                         └─────────────┘                │
│  └─────────────┘                                                        │
│                                                                          │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐                │
│  │  Question   │────▶│   Answer    │     │   Story     │                │
│  └─────────────┘     └─────────────┘     └─────────────┘                │
│         │                   │                   │                        │
│         ▼                   ▼                   ▼                        │
│  ┌─────────────────────────────────────────────────────┐                │
│  │                       Like                          │                │
│  └─────────────────────────────────────────────────────┘                │
│                                                                          │
└──────────────────────────────────────────────────────────────────────────┘
```

---

## 8. 이 데이터 구조가 만들어내는 핵심 가치

| 역할 | 핵심 가치 |
|------|----------|
| **학생** | 정확한 전략 + 실천 과제 + **동기 부여 (뱃지)** |
| **학부모** | 한눈에 보는 입시·일정·진단 + **시뮬레이션** |
| **컨설턴트** | 정리된 학생 데이터 + **트렌드 분석** 기반 상담 |
| **서비스** | 입력→분석→AI→전략→행동→**커뮤니티**→리포트 파이프라인 |

---

## 9. 파일 목적

이 문서는 개발 환경에서 팀이 다음을 위해 활용한다:

- ✅ 데이터베이스 설계
- ✅ API 스펙 설계
- ✅ 모듈 구조화 (NestJS)
- ✅ 기능 개발 우선순위 결정
- ✅ 데이터 보안/접근 권한 설계
- ✅ PRD → 실제 개발 간 일관성 유지

---

**Version History:**
- v1.0: 초기 데이터 구조 (6개 도메인)
- **v1.2: MVP 완성 (10개 도메인)**


