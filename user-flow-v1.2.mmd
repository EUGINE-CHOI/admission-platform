%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#4F46E5', 'primaryTextColor': '#fff', 'primaryBorderColor': '#4338CA', 'lineColor': '#6366F1', 'secondaryColor': '#E0E7FF', 'tertiaryColor': '#F5F3FF'}}}%%

flowchart LR
    %% =====================================
    %% Version: 1.2 (MVP 완성판)
    %% Last Updated: 2025-12-19
    %% Changes: M11~M20 신규 기능 반영
    %% =====================================

    %% =====================================
    %% GLOBAL ENTRY: 공용 진입 지점
    %% =====================================
    A0[🏠 Landing / Login] --> S0[👨‍🎓 학생으로 로그인]
    A0 --> P0[👨‍👩‍👧 학부모로 로그인]
    A0 --> C0[👔 컨설턴트로 로그인]
    A0 --> DEMO[🎮 데모 체험\n테스트 계정 자동 로그인]
    
    DEMO --> S2

    %% =====================================
    %% STUDENT FLOW (확장됨)
    %% =====================================
    subgraph STUDENT[🎓 Student Flow]
        direction TB

        %% 온보딩 & 홈
        S0 --> S1[📋 학생 온보딩\n- 튜토리얼 가이드\n- 학교/학년 설정\n- 희망 진로/계열\n- 간단 성향 체크]
        S1 --> S2[🏠 학생 홈 대시보드\n- D-Day 카운트다운 ⭐\n- 이번 주 추천 액션\n- 뱃지 현황 ⭐\n- 추천 학교 요약]

        %% 데이터 입력
        S2 --> S3[📝 데이터 입력 화면\n- 성적(지필/수행)\n- 활동(세특/동아리/창체)\n- 독서 기록]
        S3 --> S3a[✅ 저장 및 검증\n- 점수 범위 체크\n- 필수 항목 확인]
        S3a --> S3b[🏆 뱃지 체크 ⭐\n- 기록왕 조건 확인\n- 자동 뱃지 부여]
        S3b --> S2

        %% 목표 설정 (신규)
        S3 --> S3c[🎯 목표 성적 설정 ⭐\n- 과목별 목표 점수\n- 진행률 추적\n- 목표 달성 뱃지]

        %% 진단 & 분석
        S2 --> S4[🔍 고입 진단 실행\n- FIT/CHALLENGE/UNLIKELY\n- 학교별 매칭 근거\n- 합격 확률 예측 ⭐]
        S4 --> S4a[📈 성적 트렌드 분석 ⭐\n- 과목별 추이 그래프\n- 개선/하락 분석\n- AI 조언]
        S4 --> S4b[🏫 학교 비교 ⭐\n- 목표 학교 비교\n- 전형별 상세 분석\n- 경쟁률 비교]
        
        %% AI 액션 플랜
        S4 --> S5[🤖 AI 액션 플랜 생성\n- 3개월 계획\n- 주간 할 일\n- 과목별 목표]
        S5 --> S6[📚 목표 학교 준비 가이드\n- 전형 구조\n- 요구 역량\n- 준비 전략]

        %% AI 고급 기능 (신규)
        S6 --> S6a[📝 AI 자기소개서 ⭐\n- 초안 자동 생성\n- AI 첨삭 피드백\n- 학교별 맞춤]
        S6 --> S6b[🎤 면접 준비 도우미 ⭐\n- 예상 질문 생성\n- 답변 예시\n- 모의 면접]

        %% Plan → 실행
        S5 --> S7[✅ 할 일(Task) 목록\n- 체크리스트 형태\n- AI 플랜 → 태스크 변환 ⭐]
        S7 --> S8[📌 Task 완료 체크\n- DONE/SKIPPED 표시\n- 실천왕 뱃지 ⭐]
        S8 --> S9[📊 학생 타임라인 업데이트\n- 점수/활동/진단 이력\n- Task 완료 이력]

        %% 뉴스 & 커뮤니티 (신규)
        S2 --> S10[📰 최신 뉴스 ⭐\n- 특목고 관련 뉴스\n- 키워드 필터링\n- 북마크 저장]
        S2 --> S11[💬 커뮤니티 Q&A ⭐\n- 질문 작성\n- 답변 달기\n- 좋아요/채택]
        S2 --> S12[✨ 합격생 후기 ⭐\n- 후기 열람\n- 댓글 작성\n- 검증 뱃지 확인]
    end

    %% =====================================
    %% PARENT FLOW (확장됨)
    %% =====================================
    subgraph PARENT[👨‍👩‍👧 Parent Flow]
        direction TB

        P0 --> P1[📋 학부모 온보딩\n- 고입 구조 요약\n- 튜토리얼 가이드\n- 서비스 기능 설명]
        P1 --> P2[🔗 자녀 계정 연결\n- 초대 코드/검색\n- 가족 관계 설정]

        P2 --> P3[🏠 학부모 대시보드\n- 3줄 스냅샷\n- D-Day 카운트다운 ⭐\n- 자녀별 요약\n- 중요 알림]
        
        %% 자녀 관리
        P3 --> P4[✅ 자녀 활동 검토/승인\n- 학생 입력 내용 확인\n- 생기부 문장 미리보기\n- 수정/승인]
        
        %% 진단 & 분석
        P3 --> P5[📊 진단 결과 열람\n- 추천 학교\n- FIT/CHALLENGE/UNLIKELY\n- 합격 확률 ⭐\n- 강점/보완점]
        P5 --> P5a[📈 성적 추이 차트 ⭐\n- 자녀 성적 그래프\n- 과목별 분석]
        P5 --> P5b[🏫 학교 비교 분석 ⭐\n- 목표 학교 비교\n- 전형별 상세]
        P5 --> P5c[🎲 합격 시뮬레이션 ⭐\n- 가상 시나리오\n- What-if 분석]
        
        %% 일정 & 전략
        P5 --> P7[💡 전략 이해\n- 왜 이 학교가 맞는지\n- 무엇을 더 준비해야 하는지]
        
        P3 --> P6[📅 입시 일정 캘린더\n- D-Day 관리 ⭐\n- 관심 학교 일정\n- 원서/면접/발표/설명회\n- 상담 일정 통합 ⭐]
        P6 --> P8[📆 일정 관리\n- 누락 방지\n- 가족 일정과 조율\n- 알림 설정]

        %% 리포트 & 뉴스
        P3 --> P9[📄 PDF 리포트 다운로드\n- 자녀 현황 요약\n- 추천 전략\n- 향후 계획]
        P3 --> P9a[📰 최신 뉴스 ⭐\n- 입시 관련 뉴스\n- 북마크]

        %% 커뮤니티 (신규)
        P3 --> P9b[💬 커뮤니티 Q&A ⭐\n- 학부모 질문/답변\n- 정보 공유]

        %% 상담 연결
        P5 --> P10[🔔 프리미엄/상담 필요성\n- 불안 요소 파악\n- 전문가 도움 필요 판단]
    end

    %% =====================================
    %% CONSULTANT FLOW (확장됨)
    %% =====================================
    subgraph CONSULTANT[👔 Consultant Flow]
        direction TB

        C0 --> C1[🏠 컨설턴트 대시보드\n- 상담 요청 목록\n- 학생 리스트\n- 오늘 일정]
        
        %% 학생 분석
        C1 --> C2[👤 학생 현황 요약 보기\n- 성적/활동/독서\n- 진단 결과\n- AI 분석 요약]
        C2 --> C2a[📈 성적 트렌드 보기 ⭐\n- 학생별 성적 추이\n- 강점/약점 분석]
        C2 --> C3[✅ 상담 준비 완료\n- 핵심 이슈 파악\n- 필요 자료 확인]

        %% 상담 진행
        C3 --> C4[💬 상담 진행\n- 온라인/오프라인/전화\n- 주요 논의 내용 기록]
        C4 --> C5[📝 상담 리포트 작성\n- AI 초안 기반\n- 컨설턴트 수정/보완]
        C5 --> C6[✅ 리포트 확정 및 저장\n- PDF 생성 ⭐\n- 학생/학부모 공유\n- 향후 상담 참고용]

        %% 일정 관리 (신규)
        C1 --> C7[📅 상담 예약 관리 ⭐\n- 가능 시간 설정\n- 예약 확인/변경\n- 캘린더 연동]
    end

    %% =====================================
    %% ADMIN FLOW (신규)
    %% =====================================
    subgraph ADMIN[🔧 Admin Flow]
        direction TB

        AD0[🔐 관리자 로그인] --> AD1[🏠 관리자 대시보드\n- KPI 현황\n- 사용자 통계\n- 시스템 상태]

        AD1 --> AD2[🏫 학교/전형 관리\n- 데이터 승인\n- 크롤링 관리\n- 일정 업데이트]
        AD1 --> AD3[🤖 AI 품질 관리\n- 출력 모니터링\n- 피드백 분석\n- 프롬프트 관리]
        AD1 --> AD4[👥 사용자 관리\n- 계정 관리\n- 컨설턴트 승인\n- 권한 설정]
        AD1 --> AD5[💬 커뮤니티 관리 ⭐\n- 신고 처리\n- 후기 검증\n- 콘텐츠 관리]
    end

    %% =====================================
    %% CROSS LINKS (역할 간 연결)
    %% =====================================

    %% 학생 온보딩 → 학부모 초대
    S1 -. 📨 자녀 초대 코드 전송 .-> P2

    %% 학생 데이터/진단 → 학부모 대시보드
    S3 -->|학생 데이터 반영| P3
    S4 -->|진단 결과 공유| P5
    S7 -->|실행 현황 반영| P3
    S4a -->|트렌드 공유| P5a

    %% 뱃지 획득 → 대시보드 알림
    S3b -.->|🏆 뱃지 알림| S2

    %% 학부모 → 컨설턴트 상담 요청
    P10 -->|상담 예약| C1

    %% 컨설턴트 리포트 → 학부모/학생
    C6 -->|리포트 공유| P9
    C6 -->|핵심 요약 반영| S2

    %% 커뮤니티 공유
    S11 <-.->|Q&A 공유| P9b

    %% 관리자 연결
    AD2 -.->|데이터 승인| S4
    AD4 -.->|컨설턴트 승인| C0
    AD5 -.->|콘텐츠 관리| S11

    %% =====================================
    %% LEGEND
    %% =====================================
    subgraph LEGEND[📌 범례]
        direction LR
        L1[기존 기능]
        L2[⭐ 신규 기능 v1.2]
    end

