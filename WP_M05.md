# 🧩 M5 — AI 에이전트 Layer 구축 (AI Intelligence)

> **목적**: 학생 데이터 + 진단 결과를 활용하여 AI 기반 문장/전략/계획을 생성하는 AI Core 개발

_Last updated: 2024-12-12_

---

## WP5.1 — AI Orchestrator 구축 ✅

**기능**: 백엔드에서 prompt + 데이터 → **Google Gemini API** 호출

**세부 기능**:
- ~~OpenAI API 연동~~ → **Google Gemini API 연동** (gemini-2.0-flash)
- 프롬프트 템플릿 관리
- AI 출력물 DB 저장 (AIOutput)
- 재시도 로직 및 에러 핸들링
- JSON 응답 파싱 (코드 블록 자동 제거)

**완료 조건**:
→ ✅ 첫 AI 답변 생성 성공, DB 저장 확인

---

## WP5.2 — 생기부 문장 생성 에이전트 ✅

**기능**: 학생 활동 → 생기부형 문장 자동 생성

**세부 기능**:
- 특정 활동 선택하여 문장 생성
- 전체 활동 종합 문장 생성
- 생성 이력 조회

**완료 조건**:
→ ✅ 학생이 "문장 초안"을 받을 수 있음

---

## WP5.3 — 동아리/교과/독서 조언 에이전트 ✅

**기능**: 3개 별도 에이전트 구축

| 에이전트 | 입력 | 출력 |
|---------|------|------|
| 동아리 추천 | 성적, 활동, 목표학교 | 추천 동아리 3개 + 이유 |
| 교과 조언 | 성적, 목표학교 전형 | 취약 과목 분석 + 학습 전략 |
| 독서 추천 | 목표학교, 기존 독서 기록 | 추천 도서 3권 + 이유 |

**완료 조건**:
→ ✅ 학생이 직접 조언을 받을 수 있음

---

## WP5.4 — AI 액션 플랜 생성 ✅

**기능**: 3개월 계획 + 주간 할 일 생성

**세부 기능**:
- 진단 결과 기반 12주 플랜 생성
- 목표 학교 특성 반영
- 주간 Task 자동 생성
- 기존 플랜 보관(ARCHIVED) 처리

**완료 조건**:
→ ✅ 학생이 첫 액션 플랜을 받아볼 수 있음

---

## WP5.5 — AI 출력물 Feedback 시스템 ✅

**기능**: "좋아요/싫어요·수정함" 저장

**세부 기능**:
- 좋아요/싫어요 피드백
- 수정 내용 저장
- 피드백 통계 조회 (관리자)

**완료 조건**:
→ ✅ AI 품질 개선 기반 확보

---

## 🆕 WP5.6 — AI 고도화 기능 (신규) ✅

**기능**: 전문가 수준의 맞춤형 AI 조언

### 5.6.1 빠른 조언 (Quick Advice)
| 항목 | 내용 |
|------|------|
| 입력 | 학생 질문/주제 |
| 출력 | 인사, 현재상태, 조언 3가지, 주간목표, 격려, 다음단계 |
| 특징 | 구체적 수치/기간 포함, 실행 가능한 액션 |

### 5.6.2 종합 분석 (Comprehensive Analysis)
| 항목 | 내용 |
|------|------|
| 입력 | 학생 전체 데이터 (자동) |
| 출력 | 종합점수(0-100), 학업분석, 활동분석, 학교적합도, 실천과제 |
| 특징 | 전체 데이터 통합 분석 |

### 5.6.3 AI 학교 추천 (School Recommendations)
| 항목 | 내용 |
|------|------|
| 입력 | 선호 지역/학교유형 (선택) |
| 출력 | 추천 학교 5개, 적합도 점수, 추천 이유, 합격 요건 |
| 특징 | 경쟁률 데이터 기반 분석 |

**완료 조건**:
→ ✅ 학생이 전문가 수준의 AI 조언을 받을 수 있음

---

## 📊 데이터 흐름

```
[M4 진단 결과]     [M2 학생 데이터]
      │                   │
      └─────────┬─────────┘
                │
                ▼
       ┌────────────────┐
       │   WP5.1        │
       │ AI Orchestrator │
       │ (Gemini 연동)  │
       └───────┬────────┘
               │
   ┌───────────┼───────────┬───────────┐
   │           │           │           │
   ▼           ▼           ▼           ▼
┌──────┐   ┌──────┐   ┌──────┐   ┌──────┐
│WP5.2 │   │WP5.3 │   │WP5.4 │   │WP5.6 │
│생기부 │   │조언   │   │플랜  │   │고도화│
│문장  │   │에이전트│   │생성  │   │기능  │
└──────┘   └──────┘   └──────┘   └──────┘
   │           │           │           │
   └───────────┴───────────┴───────────┘
               │
               ▼
       ┌────────────────┐
       │   WP5.5        │
       │ 피드백 시스템   │
       └────────────────┘
```

---

## 📝 관련 시나리오 문서

→ `SCENARIO_M5_AI_Layer.md` 참조

---

## ⚠️ 환경 설정 필수

| 환경 변수 | 설명 | 예시 |
|----------|------|------|
| ~~`OPENAI_API_KEY`~~ | ~~OpenAI API 키~~ | 변경됨 |
| **`GEMINI_API_KEY`** | **Google Gemini API 키** | `AIzaSy...` |
| **`GEMINI_MODEL`** | **사용할 모델** | `gemini-2.0-flash` |

---

## 📊 DB 모델

| 모델 | 설명 | 주요 필드 |
|------|------|----------|
| `AIOutput` | AI 생성물 저장 | type, prompt, response, studentId |
| `AIFeedback` | 피드백 저장 | type, comment, editedContent |
| `ActionPlan` | 액션 플랜 | title, goals, status, startDate |
| `WeeklyTask` | 주간 할 일 | weekNumber, title, status |

---

## 📡 API 엔드포인트

| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/ai/health` | AI 서비스 상태 (Gemini) |
| POST | `/ai/record-sentence` | 생기부 문장 생성 |
| POST | `/ai/recommend/club` | 동아리 추천 |
| POST | `/ai/advice/subject` | 교과 조언 |
| POST | `/ai/recommend/reading` | 독서 추천 |
| POST | `/ai/action-plan` | 액션 플랜 생성 |
| **POST** | `/ai/advice/quick` | **빠른 조언 (신규)** |
| **POST** | `/ai/analysis/comprehensive` | **종합 분석 (신규)** |
| **POST** | `/ai/recommend/school` | **AI 학교 추천 (신규)** |
